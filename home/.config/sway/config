### Variables
set {
  # Logo key. Use Mod1 for Alt.
  $mod Mod4

  # Home row direction keys, like vi
  $left h
  $down j
  $up k
  $right l

  # Terminal emulator
  $term footclient

  # Application launcher
  #$launcher bemenu-run --no-exec | xargs swaymsg exec --

  # Interactive menu
  #$menu bemenu

  # Font
  $font Cascadia Code 14
}

### Appearance
# Color
set {
  $d #282c34
  $l #abb2bf
  #$a #fe8cb3
  $a #61afef
}

client.focused          $a $d $l $l $a
client.focused_inactive $d $d $l $l $d
client.unfocused        $d $d $l $l $d
client.urgent           $d $d $l $l $d

# Border settings
smart_gaps on
smart_borders on
gaps inner 7
gaps outer 0
for_window [class="^.*"] border pixel 1
hide_edge_borders smart
default_border pixel 1
default_floating_border pixel 2
workspace_auto_back_and_forth yes

# Titlebar font
font $font

# Titlebar settings
titlebar_border_thickness 0
titlebar_padding 10 1

floating_modifier $mod

# Floating windows
for_window {
  [app_id="virt-manager"] floating enable
  [class="Pavucontrol"] floating enable
  [app_id="launcher"] floating enable
}

# Bar
bar swaybar_command waybar

### Output configuration
# Wallpaper
output "*" bg ~/.local/wallpaper/nix.png fill

### Input configuration
# Keyboard
input "type:keyboard" {
  xkb_layout us,ru
  xkb_options grp:caps_toggle
}
# Touchpad
input "type:touchpad" {
  left_handed enabled
  tap enabled
  natural_scroll enabled
  dwt enabled
}

### Seat
# Hide cursor when typing
seat "*" hide_cursor when-typing enable

### Idle configuration
# Start idle tracker
exec swayidle \
  timeout 600 'swaymsg "output * dpms off"' \
    resume 'swaymsg "output * dpms on"' \
  timeout 620 swaylock \
  before-sleep swaylock

### Bindings
# Media keys
bindsym --locked {
  # Brightness
  XF86MonBrightnessDown exec light -U 5
  XF86MonBrightnessUp exec light -A 5
  # Sound
  XF86AudioRaiseVolume exec amixer set Master 1+
  XF86AudioLowerVolume exec amixer set Master 1-
  XF86AudioMute exec amixer set Master toggle
  # Media Playback
  XF86AudioPlay exec playerctl play-pause
  XF86AudioNext exec playerctl next
  XF86AudioPrev exec playerctl previous
}

# General actions
bindsym --to-code {
  # Start a terminal
  $mod+Return exec $term

  # Make a screenshot and copy to clipboard
  $mod+p exec grim - | wl-copy --type image/png
  $mod+Shift+p exec grim -g "$(slurp)" - | wl-copy --type image/png

  # Make a screenshot
  $mod+Mod1+p exec grimshot copy screen
  $mod+Mod1+Shift+p exec grimshot copy window

  # Start your browser
  $mod+Shift+f exec firefox

  # Open fm
  $mod+Shift+n exec nautilus

  # Kill focused window
  $mod+Shift+q kill

  # Start your launcher
  $mod+d exec footclient --app-id=launcher sh -c " \
      ls /run/current-system/sw/bin $HOME/.nix-profile/bin | \
      fzf --height=100% --border=none --margin=0,1 | \
      xargs swaymsg exec --"


  # Reload the configuration file
  $mod+Shift+c reload

  # Exit sway
  $mod+Shift+e exec swaynag -t warning -m 'Exit sway?' -b 'Yes' 'swaymsg exit'
}

# Movement
bindsym --to-code {
  # Move your focus around
  $mod+$left focus left
  $mod+$down focus down
  $mod+$up focus up
  $mod+$right focus right

  # Move the focused window with the same, but add Shift
  $mod+Shift+$left move left
  $mod+Shift+$down move down
  $mod+Shift+$up move up
  $mod+Shift+$right move right
}

# Workspaces
bindsym {
  # Switch to workspace
  $mod+1 workspace 1
  $mod+2 workspace 2
  $mod+3 workspace 3
  $mod+4 workspace 4
  $mod+5 workspace 5
  $mod+6 workspace 6
  $mod+7 workspace 7
  $mod+8 workspace 8
  $mod+9 workspace 9
  $mod+0 workspace 0

  # Move focused container to workspace
  $mod+Shift+1 move container to workspace 1
  $mod+Shift+2 move container to workspace 2
  $mod+Shift+3 move container to workspace 3
  $mod+Shift+4 move container to workspace 4
  $mod+Shift+5 move container to workspace 5
  $mod+Shift+6 move container to workspace 6
  $mod+Shift+7 move container to workspace 7
  $mod+Shift+8 move container to workspace 8
  $mod+Shift+9 move container to workspace 9
  $mod+Shift+0 move container to workspace 0
}

# Layout stuff
bindsym --to-code {
  # You can "split" the current object of your focus with
  # $mod+b or $mod+v, for horizontal and vertical splits
  # respectively.
  $mod+b splith
  $mod+v splitv

  # Switch the current container between different layout styles
  $mod+s layout stacking
  $mod+w layout tabbed
  $mod+e layout toggle split

  # Make the current focus fullscreen
  $mod+f fullscreen

  # Toggle the current focus between tiling and floating mode
  $mod+Shift+space floating toggle

  # Swap focus between the tiling area and the floating area
  $mod+space focus mode_toggle

  # Move focus to the parent container
  $mod+a focus parent
}

# Scratchpad
bindsym {
  # Move the currently focused window to the scratchpad
  $mod+Shift+minus move scratchpad

  # Show the next scratchpad window or hide the focused scratchpad
  # window. If there are multiple scratchpad windows, this command
  # cycles through them.
  $mod+minus scratchpad show
}

# Resizing containers
mode "resize" {
  bindsym --to-code {
    $left resize shrink width 25px
    $down resize grow height 25px
    $up resize shrink height 25px
    $right resize grow width 25px

    # Return to default mode
    Return mode "default"
    Escape mode "default"
  }
}

bindsym --to-code $mod+r mode "resize"

mode "power" {
  bindsym --to-code Escape mode 'default'
  bindsym --to-code Return mode 'default'
  bindsym --to-code l exec swaylock; mode 'default'
  bindsym --to-code p exec systemctl poweroff; mode 'default'
  bindsym --to-code r exec systemctl reboot; mode 'default'
  bindsym --to-code s exec swaylock; exec systemctl suspend; mode 'default'
}
bindsym --to-code $mod+c mode "power"

### Service
# Autostart
exec {
    # D-Bus session
    pgrep -x dbus-daemon || dbus-daemon --session \
        --address=unix:path=$XDG_RUNTIME_DIR/bus &

    # Notification daemon
    pgrep -x mako || mako &

    # Foot server, so we can use footclient as term
    pgrep -xf 'foot --server' || \
        foot --server --log-no-syslog --log-level=warning &
}
